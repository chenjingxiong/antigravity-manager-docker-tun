version: '3.8'

services:
  # Antigravity-Manager 服务
  antigravity-manager:
    image: lbjlaq/antigravity-manager:latest
    container_name: antigravity-manager
    ports:
      - "8045:8045"
    volumes:
      - ~/.antigravity_tools:/root/.antigravity_tools
    environment:
      - LOG_LEVEL=info
      - API_KEY=your-secret-key  # [重要] 请设置您的安全密钥
      - WEB_PASSWORD=your-login-password  # 可选，Web UI 登录密码
    restart: unless-stopped
    networks:
      - antigravity-net

  # metacubexd - Mihomo Dashboard (Clash Web UI)
  metacubexd:
    container_name: metacubexd
    image: ghcr.io/metacubex/metacubexd
    restart: always
    ports:
      - "8080:80"
    environment:
      - DEFAULT_BACKEND_URL=http://clash:9090
    depends_on:
      - clash
    networks:
      - antigravity-net

  # Clash 服务（用于 metacubexd 后端）
  clash:
    image: dreamacro/clash:latest
    container_name: clash
    privileged: true
    network_mode: bridge
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      # Clash 配置文件挂载
      - ./config/clash:/root/.config/clash
      # 日志目录
      - ./logs/clash:/var/log/clash
    ports:
      # Clash HTTP 代理端口
      - "7890:7890"
      # Clash SOCKS5 代理端口
      - "7891:7891"
      # Clash RESTful API 端口（metacubexd 需要）
      - "9090:9090"
    restart: unless-stopped
    networks:
      - antigravity-net

networks:
  antigravity-net:
    driver: bridge
